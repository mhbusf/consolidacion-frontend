<div class="dashboard-container">
  <h2 class="dashboard-title">üìä Dashboard de Seguimiento</h2>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando dashboard...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    <strong>‚ö†Ô∏è Error:</strong> {{ error }}
  </div>

  <div *ngIf="dashboard && !loading">

    <div class="stats-grid">
      <div class="stat-card gradient-blue cursor-pointer" (click)="abrirModal('TOTAL')">
        <div class="stat-icon">üìã</div>
        <div class="stat-content">
          <div class="stat-number">{{ dashboard.totalConsolidados }}</div>
          <div class="stat-label">Total Consolidados</div>
        </div>
      </div>

      <div class="stat-card gradient-purple cursor-pointer" (click)="abrirModal('EN_PROCESO')">
        <div class="stat-icon">üîÑ</div>
        <div class="stat-content">
          <div class="stat-number">{{ dashboard.consolidadosEnProceso }}</div>
          <div class="stat-label">En Proceso</div>
        </div>
      </div>

      <div class="stat-card gradient-green cursor-pointer" (click)="abrirModal('AL_DIA')">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-content">
          <div class="stat-number">{{ dashboard.consolidadosAlDia }}</div>
          <div class="stat-label">Al D√≠a</div>
        </div>
      </div>

      <div class="stat-card gradient-red cursor-pointer" (click)="abrirModal('ATRASADOS')">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-content">
          <div class="stat-number">{{ dashboard.consolidadosAtrasados }}</div>
          <div class="stat-label">Con Atrasos</div>
        </div>
      </div>
    </div>

    <div class="stats-grid-secondary">
      <div class="stat-card gradient-teal cursor-pointer" (click)="abrirModal('CON_GDC')">
        <div class="stat-icon">üìù</div>
        <div class="stat-content">
          <div class="stat-number">{{ dashboard.consolidadosConGDC }}</div>
          <div class="stat-label">Con GDC Asignado</div>
        </div>
      </div>

      <div class="stat-card gradient-gray cursor-pointer" (click)="abrirModal('CERRADO')">
        <div class="stat-icon">üîí</div>
        <div class="stat-content">
          <div class="stat-number">{{ dashboard.consolidadosCerrados }}</div>
          <div class="stat-label">Cerrados</div>
        </div>
      </div>
    </div>

    <div class="table-section" *ngIf="dashboard.consolidadosConAtrasos && dashboard.consolidadosConAtrasos.length > 0">
      <div class="section-header">
        <h3>‚ö†Ô∏è Resumen de Atrasos Cr√≠ticos</h3>
        <span class="badge-count">{{ dashboard.consolidadosConAtrasos.length }}</span>
      </div>
      <div class="table-container">
        <table class="dashboard-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Asignado a</th>
              <th>Estado</th>
              <th>Fecha Ingreso</th>
              <th>D√≠as Atraso</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let consol of dashboard.consolidadosConAtrasos" class="table-row">
              <td class="fw-bold">{{ consol.titulo }}</td>
              <td><span class="user-badge">{{ consol.asignadoA }}</span></td>
              <td><span class="badge" [ngClass]="getEstadoClass(consol.estado)">{{ consol.estado }}</span></td>
              <td>{{ consol.fechaIngreso | date: 'dd/MM/yyyy' }}</td>
              <td class="text-center">
                <span class="badge-atraso" [ngClass]="getAtrasoClass(consol.diasDeAtraso)">
                  {{ consol.diasDeAtraso }} d√≠as
                </span>
              </td>
              <td>
                <button class="btn-action" (click)="verConsolidado(consol.id)">Ver</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="success-message" *ngIf="!dashboard.consolidadosConAtrasos || dashboard.consolidadosConAtrasos.length === 0">
      <div class="success-icon">üéâ</div>
      <h3>¬°Excelente trabajo!</h3>
      <p>Todos los consolidados est√°n al d√≠a.</p>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ modalTitle }}</h3>
      <button class="close-btn" (click)="cerrarModal()">√ó</button>
    </div>

    <div class="modal-body">
      <div *ngIf="loadingModal" class="text-center py-4">
        <div class="spinner"></div>
        <p>Cargando lista...</p>
      </div>

      <div *ngIf="!loadingModal && modalList.length === 0" class="text-center py-4">
        <p>No se encontraron registros en esta categor√≠a.</p>
      </div>

      <table class="dashboard-table" *ngIf="!loadingModal && modalList.length > 0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Tel√©fono</th> <th>Asignado A</th> <th>Acci√≥n</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of modalList">
            <td>{{ item.id }}</td>
            <td class="fw-bold">{{ item.nombre }}</td>
            <td>{{ item.telefono }}</td>
            <td>
              <span class="user-badge" [class.bg-danger]="!item.usuarioAsignado">
                {{ item.usuarioAsignado || 'Sin Asignar' }}
              </span>
            </td>
            <td>
              <button class="btn-action" (click)="verConsolidado(item.id)">Ver</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
